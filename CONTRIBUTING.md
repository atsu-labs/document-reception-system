# コントリビューションガイド

届出管理システム（Document Reception System）へのコントリビューションをご検討いただき、ありがとうございます！

このドキュメントでは、プロジェクトへの貢献方法について説明します。

## 目次

- [行動規範](#行動規範)
- [はじめる前に](#はじめる前に)
- [開発環境のセットアップ](#開発環境のセットアップ)
- [コントリビューションの種類](#コントリビューションの種類)
- [開発フロー](#開発フロー)
- [コーディング規約](#コーディング規約)
- [テストとCI](#テストとci)
- [コミットガイドライン](#コミットガイドライン)
- [Pull Requestのガイドライン](#pull-requestのガイドライン)
- [レビュープロセス](#レビュープロセス)

## 行動規範

本プロジェクトに参加するすべての人には、建設的で尊重のある環境を維持することが期待されます。

### 基本原則

- **相互尊重**: 異なる意見や経験レベルを尊重する
- **建設的なコミュニケーション**: フィードバックは具体的かつ建設的に
- **協力的な姿勢**: チームメンバーを支援し、共に成長する
- **オープンマインド**: 新しいアイデアや異なるアプローチを歓迎する

## はじめる前に

### 確認事項

1. **既存のIssueを検索**: 同じ問題や機能要望がないか確認
2. **READMEを読む**: セットアップ手順と基本情報を確認
3. **システム仕様書を確認**: [system_specification.md](./system_specification.md)で設計思想を理解

### 質問がある場合

- **既存のIssueを検索**: 同様の質問がないか確認
- **新しいIssueを作成**: 質問用のIssueを作成
- **詳細を記載**: 何を試したか、期待する動作、実際の動作

## 開発環境のセットアップ

詳細は[README.md](./README.md#開発環境のセットアップ)を参照してください。

### 最小要件

- **Node.js**: v20以上
- **pnpm**: v8以上
- **Git**: v2.x以上

### 推奨環境

- **OS**: macOS, Linux, Windows (WSL2推奨)
- **エディタ**: VS Code (TypeScript, ESLint, Prettierの拡張機能推奨)
- **ブラウザ**: Chrome / Firefox の最新版（開発者ツール使用）

## コントリビューションの種類

### 1. バグ報告

バグを発見した場合：

1. **既存のIssueを確認**: 同じバグが報告されていないか検索
2. **再現可能な情報を収集**:
   - エラーメッセージ（全文）
   - 実行環境（OS, Node.js, pnpmのバージョン）
   - 再現手順（ステップバイステップ）
   - 期待される動作と実際の動作
   - スクリーンショットやログ
3. **Issueテンプレートを使用**: バグ報告用のテンプレートに従う

### 2. 機能提案

新機能を提案する場合：

1. **目的を明確にする**: なぜその機能が必要か
2. **ユースケースを説明**: どのように使用されるか
3. **代替案を検討**: 他の実現方法はないか
4. **影響範囲を考慮**: 既存機能への影響

### 3. ドキュメント改善

ドキュメントの改善は常に歓迎します：

- 誤字脱字の修正
- 説明の追加・明確化
- サンプルコードの追加
- 翻訳（必要に応じて）

### 4. コード改善

コードの改善には以下が含まれます：

- パフォーマンスの最適化
- コードの可読性向上
- リファクタリング
- テストカバレッジの向上

## 開発フロー

### 1. Issueの作成または確認

```bash
# 機能追加の場合
Issue番号: #123
タイトル: 届出一覧に日付範囲フィルターを追加
```

### 2. リポジトリのフォークとクローン

```bash
# フォーク後、ローカルにクローン
git clone https://github.com/YOUR_USERNAME/document-reception-system.git
cd document-reception-system

# オリジナルリポジトリをupstreamとして追加
git remote add upstream https://github.com/atsu-labs/document-reception-system.git
```

### 3. ブランチの作成

```bash
# mainブランチから最新の状態を取得
git checkout main
git pull upstream main

# 作業ブランチを作成
git checkout -b feature/issue-123-add-date-filter
```

**ブランチ命名規則**:
- `feature/issue-番号-説明`: 新機能
- `fix/issue-番号-説明`: バグ修正
- `docs/issue-番号-説明`: ドキュメント
- `refactor/issue-番号-説明`: リファクタリング
- `test/issue-番号-説明`: テスト追加

### 4. 開発

```bash
# 依存関係のインストール
pnpm install

# 開発サーバーの起動
pnpm dev

# コードを編集...
```

### 5. テスト

```bash
# lintチェック
pnpm lint

# ビルド確認
pnpm build

# テスト実行（テストが存在する場合）
pnpm test
```

### 6. コミット

```bash
# 変更をステージング
git add .

# コミット（コミットメッセージ規約に従う）
git commit -m "feat: 届出一覧に日付範囲フィルターを追加"
```

### 7. プッシュとPR作成

```bash
# フォークしたリポジトリにプッシュ
git push origin feature/issue-123-add-date-filter
```

その後、GitHubでPull Requestを作成します。

## コーディング規約

### TypeScript

- **厳格な型付け**: `any`の使用は最小限に
- **インターフェース優先**: オブジェクトの型定義はinterfaceを使用
- **命名規則**:
  - 変数・関数: `camelCase`
  - クラス・インターフェース: `PascalCase`
  - 定数: `UPPER_SNAKE_CASE`
  - プライベートメンバー: `_prefixedCamelCase`

### React

- **関数コンポーネント**: クラスコンポーネントは使用しない
- **Hooks**: 適切なHooksの使用（useState, useEffect, etc.）
- **コンポーネント分割**: 1ファイル1コンポーネントを基本とする
- **命名規則**: コンポーネントファイルは`PascalCase.tsx`

### バックエンド

- **ルーティング**: Honoのルーターを使用
- **バリデーション**: Zodを使用した入力検証
- **エラーハンドリング**: 適切なHTTPステータスコードとエラーメッセージ
- **データベース**: Drizzle ORMを使用、生SQLは最小限に

### コードスタイル

ESLintの設定に従ってください：

```bash
# 自動修正
pnpm lint --fix
```

### コメント

- **必要な場所にのみ記載**: コードを読めば分かることは書かない
- **なぜ（Why）を説明**: 何を（What）ではなく、なぜそうしたかを説明
- **TODO/FIXMEの使用**: 将来の改善点を明示

```typescript
// ❌ 悪い例
// userIdを取得
const userId = user.id;

// ✅ 良い例
// パフォーマンス改善のため、クエリ結果をキャッシュ
const cachedResult = await getCachedData(userId);
```

## テストとCI

### ローカルテスト

```bash
# lintチェック
pnpm --filter backend lint
pnpm --filter frontend lint

# ビルドテスト
pnpm --filter backend build
pnpm --filter frontend build

# データベーステスト
pnpm --filter backend db:verify
```

### 手動テスト

重要な変更の場合、手動テストを実施してください：

1. **機能テスト**: 実装した機能が正常に動作するか
2. **リグレッションテスト**: 既存機能が壊れていないか
3. **エッジケース**: 異常系やエッジケースの動作確認

### CI/CD

Pull Request作成時、以下のチェックが自動実行されます：

- **Lintチェック**: コードスタイルの確認
- **ビルドチェック**: ビルドが成功するか
- **テスト実行**: 自動テストの実行（設定されている場合）

すべてのチェックがパスすることを確認してください。

## コミットガイドライン

### コミットメッセージフォーマット

```
<type>: <subject>

<body>

<footer>
```

### Type

- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの意味に影響しない変更（フォーマット、セミコロンなど）
- `refactor`: バグ修正や機能追加を含まないコード変更
- `perf`: パフォーマンス改善
- `test`: テストの追加や修正
- `chore`: ビルドプロセスやツールの変更

### Subject

- 50文字以内
- 現在形を使用（"add" not "added"）
- 最初の文字は小文字（日本語の場合は不要）
- 末尾にピリオドを付けない

### 例

```bash
# 良い例
git commit -m "feat: 届出一覧に日付範囲フィルターを追加"
git commit -m "fix: ログイン時の認証エラーを修正"
git commit -m "docs: READMEのセットアップ手順を更新"

# 悪い例
git commit -m "update"  # 説明が不十分
git commit -m "fix bug"  # 何のバグか不明
git commit -m "いろいろ修正"  # 曖昧すぎる
```

### コミットの粒度

- **1つのコミットに1つの変更**: 複数の無関係な変更を混ぜない
- **論理的な単位でコミット**: 動作する状態でコミット
- **頻繁にコミット**: 大きな変更は小さく分割

## Pull Requestのガイドライン

### PRの作成前チェックリスト

- [ ] 最新のmainブランチをマージ済み
- [ ] lintチェックがパス
- [ ] ビルドが成功
- [ ] 手動テストを実施
- [ ] 関連ドキュメントを更新
- [ ] コミットメッセージが規約に準拠

### PRテンプレート

```markdown
## 概要
このPRの目的と変更内容の要約を記載してください。

## 関連Issue
Closes #123

## 変更内容
- [ ] バックエンド: XXX機能の実装
- [ ] フロントエンド: XXX画面の追加
- [ ] データベース: XXXテーブルの追加
- [ ] ドキュメント: XXXの更新

## テスト
- [ ] 手動テストを実施
- [ ] ビルドが正常に完了
- [ ] 既存機能に影響がないことを確認

## スクリーンショット
UIに変更がある場合、スクリーンショットを添付してください。

## レビュー観点
- セキュリティ上の懸念はないか
- パフォーマンスへの影響はないか
- ドキュメントの更新は必要か
```

### PRのタイトル

コミットメッセージと同様の形式：

```
feat: 届出一覧に日付範囲フィルターを追加
fix: ログイン時の認証エラーを修正
docs: READMEにトラブルシューティングセクションを追加
```

### PRの説明

- **何を変更したか**: 変更内容の概要
- **なぜ変更したか**: 変更の理由や背景
- **どのように実装したか**: 実装の概要（複雑な場合）
- **影響範囲**: 既存機能への影響
- **テスト方法**: 動作確認の方法

### スクリーンショット

UIに変更がある場合、以下を含めてください：

- **Before/After**: 変更前後の比較
- **主要な画面**: 新しい画面や変更された画面
- **異なるブレークポイント**: レスポンシブ対応の場合

## レビュープロセス

### レビュアーの役割

- **コードの品質確認**: ベストプラクティスに従っているか
- **バグの発見**: 潜在的な問題がないか
- **機能の確認**: 要件を満たしているか
- **保守性の確認**: 理解しやすく、保守しやすいか

### レビューのポイント

1. **機能性**: 要件を満たしているか
2. **正確性**: バグやエラーがないか
3. **パフォーマンス**: 効率的な実装か
4. **セキュリティ**: セキュリティ上の問題がないか
5. **可読性**: コードが理解しやすいか
6. **テスト**: 適切にテストされているか
7. **ドキュメント**: 必要な文書が更新されているか

### レビューコメントの書き方

- **具体的に**: 何が問題で、どう改善すべきか
- **建設的に**: 批判ではなく、改善提案として
- **質問形式も活用**: "〜の方が良いのではないでしょうか？"

### レビュー対応

- **すべてのコメントに返信**: 対応した/しない理由を説明
- **質問には丁寧に回答**: 理解を深める機会として
- **感謝の気持ちを忘れずに**: レビューしてくれたことに感謝

### マージの条件

- [ ] 最低1名のApprove取得
- [ ] すべてのCIチェックがパス
- [ ] コンフリクトが解消済み
- [ ] レビューコメントが解決済み

## その他

### セキュリティの脆弱性を発見した場合

公開Issueではなく、プロジェクトメンテナーに直接連絡してください。

### ライセンス

コントリビューションはプロジェクトのライセンス（ISC）に従います。

## 質問やサポート

- **Issue**: 一般的な質問やバグ報告
- **Discussion**: 設計や実装方針についての議論
- **ドキュメント**: [README.md](./README.md)と[system_specification.md](./system_specification.md)

---

改めて、コントリビューションに感謝します！一緒により良いシステムを作りましょう 🚀
